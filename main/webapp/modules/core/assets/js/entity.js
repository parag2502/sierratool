jQuery(document).ready(function($) {
    var weburl = 'https://'+window.location.hostname+'/web';
	//entity submission
	jQuery('body').on('click', '.entity-submit', function() {
		//defince variable for get input field data
        var entityname = $("#entity-name").val();
		var entitylink = $("#entity-link").val();
		var entitydescription = $("#entity-description").val();
		var entitycover = $("#entity-cover").val();
		var entitylogo = $("#entity-logo").val();
		if( $("#entity-autogenrated").is(':checked')) {
			var entityautogenrated = $("#entity-autogenrated").val();
        }
		else {
			var entityautogenrated = 'false';
		}
		if( $("#entity-isactive").is(':checked')) {
			var entityisactive = $("#entity-isactive").val();
        }
		else {
			var entityisactive = 'false';
		}								
		var entityisactive = $("#entity-isactive").val();
		if (!entityname || !entityname.length) {
            $('.error').show();
            $(".error").html('Please enter name');
        }
		else if(!entitylink || !entitylink.length) {
			 $('.error').show();
            $(".error").html('Please enter Link');
		}
		else if(!entitydescription || !entitydescription.length) {
			 $('.error').show();
            $(".error").html('Please enter Description');
		}
		else if(!entitycover || !entitycover.length) {
			 $('.error').show();
            $(".error").html('Please enter Cover URL');
		}
		else if(!entitylogo || !entitylogo.length) {
			 $('.error').show();
            $(".error").html('Please enter Logo URL');
		}
		else {
			$('.error').hide();
			
			firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
			  user.getIdToken().then(function(idToken) {
				 var encode = idToken;
                    $.ajax({
                    type: "POST",
					dataType: "json",
                    url: weburl+"/admin/ajax/entity/entity-ajax.php",
                      data: {
                              entityname: entityname,
							  entitylink: entitylink,
                              entitydescription: entitydescription,
                              entitycover: entitycover,
                              entitylogo: entitylogo,
							  entityautogenrated: entityautogenrated,
							  entityisactive: entityisactive,
							  encode: encode,
                             },
							 success: function(msg) {
								 if(msg['success'] == 'success') {
									 $('.success').show();
                                     $(".success").html('Entity Submited Successfully');
								 }
								 else if(msg['fail'] == 'fail') {
									 $('.error').show();
                                     $(".error").html('Please Check Field And Try Again!');
								 }
							 }
				 });
				 });
				 }
		});
		}
		
	});	
		
	//entity edit	
	jQuery('body').on('click', '.entity-edit', function() {	
		var entityid = $('body').find(this).attr("entity-edit");
		$("#entity-edit-id").val(entityid);
		firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
			  user.getIdToken().then(function(idToken) {
				 var encode = idToken;
                    $.ajax({
                    type: "POST",
					dataType: "json",
                    url: weburl+"/admin/ajax/entity/entity-get.php",
                      data: {
                              entityid: entityid,
							  encode: encode,
                             },
							 success: function(msg) {
								 if(msg['success'] == 'success') {
									$("#entity-name-edit").val(msg['name']);
									$("#entity-link-edit").val(msg['wikiUrl']);
									$("#entity-description-edit").val(msg['description']);
									$("#entity-cover-edit").val(msg['coverurl']);
									$("#entity-logo-edit").val(msg['logourl']);
									if(msg['isAutoGenerated'] == true) {
										$("#entity-autogenrated-edit").prop('checked', true);
									}
									else {
										$("#entity-autogenrated-edit").prop('checked', false);
									}
									if(msg['isActive'] == true) {
										$("#entity-isactive-edit").prop('checked', true);
									}
									else {
										$("#entity-isactive-edit").prop('checked', false);
									}
								 }
								 else if(msg['fail'] == 'fail') {
									 alert('There is a error please reload page and try again.');
								 }
							 }
				 });	
				 });
				 }
		});
	});
	
	//entity-update
	jQuery('body').on('click', '.entity-submit-edit', function() {		
		//defince variable for get input field data
        var entityname = $("#entity-name-edit").val();
		var entitylink = $("#entity-link-edit").val();
		var entitydescription = $("#entity-description-edit").val();
		var entitycover = $("#entity-cover-edit").val();
		var entitylogo = $("#entity-logo-edit").val();
		if( $("#entity-autogenrated-edit").is(':checked')) {
			var entityautogenrated = $("#entity-autogenrated-edit").val();
        }
		else {
			var entityautogenrated = 'false';
		}
		if( $("#entity-isactive-edit").is(':checked')) {
			var entityisactive = $("#entity-isactive-edit").val();
        }
		else {
			var entityisactive = 'false';
		}
		var entityeditid = $("#entity-edit-id").val();
		if (!entityname || !entityname.length) {
            $('.error-edit').show();
            $(".error-edit").html('Please enter name');
        }
		else if(!entitylink || !entitylink.length) {
			 $('.error-edit').show();
            $(".error-edit").html('Please enter Link');
		}
		else if(!entitydescription || !entitydescription.length) {
			 $('.error-edit').show();
            $(".error-edit").html('Please enter Description');
		}
		else if(!entitycover || !entitycover.length) {
			 $('.error-edit').show();
            $(".error-edit").html('Please enter Cover URL');
		}
		else if(!entitylogo || !entitylogo.length) {
			 $('.error-edit').show();
            $(".error-edit").html('Please enter Logo URL');
		}
		else {
			$('.error-edit').hide();
			
			firebase.auth().onAuthStateChanged(function(user) {
		  if (user) {
			  user.getIdToken().then(function(idToken) {
				 var encode = idToken;
                    $.ajax({
                    type: "POST",
					dataType: "json",
                    url: weburl+"/admin/ajax/entity/entity-ajax-edit.php",
                      data: {
                              entityname: entityname,
							  entitylink: entitylink,
                              entitydescription: entitydescription,
                              entitycover: entitycover,
                              entitylogo: entitylogo,
							  entityautogenrated: entityautogenrated,
							  entityisactive: entityisactive,
							  entityeditid: entityeditid,
							  encode: encode,
                             },
							 success: function(msg) {
								 if(msg['success'] == 'success') {
									 $('.success-edit').show();
                                     $(".success-edit").html('Entity Submited Successfully');
								 }
								 else if(msg['fail'] == 'fail') {
									 $('.error-edit').show();
                                     $(".error-edit").html('Please Check Field And Try Again!');
								 }
							 }
				 });
				 });
				 }
		});
		}
		
	});	

});

	var linkedentities = new Bloodhound({
	  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),
	  queryTokenizer: Bloodhound.tokenizers.whitespace,
	  prefetch: {
		url: weburl+'/admin/ajax/entity/get-entity.php',
	  }
	});
	linkedentities.initialize();

	$('#rss-entities').tagsinput({
	  typeaheadjs: {
		name: 'linkedentities',
		displayKey: 'text',
		valueKey: 'value',
		source: linkedentities.ttAdapter()
	  }
	});
	
	$('#rss-entities-edit').tagsinput({
	  typeaheadjs: {
		name: 'linkedentities',
		displayKey: 'text',
		valueKey: 'value',
		source: linkedentities.ttAdapter()
	  }
	});	